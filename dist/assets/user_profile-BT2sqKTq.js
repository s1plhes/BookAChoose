import{j as N,o as l,c as r,a as e,k as h,l as x,n as _,t as i,u as g,F as y,h as E,m as L,d as b,y as T,r as f,g as U,f as R,w as V,v as M,H as D,q as F}from"./index-UL2W14HF.js";import{f as I}from"./formatDate-CRdf8c_1.js";const S={class:"flex items-start space-x-4"},H=["src"],q={class:"flex-1"},z={class:"flex justify-between items-center"},J={class:"font-semibold text-yellow-500"},P={class:"text-sm text-gray-500"},G={class:"text-slate-200 mt-2"},K={key:0,class:"ml-12 mt-4"},j={__name:"pComment",props:["comment"],emits:["reply"],setup(c,{emit:w}){return(a,u)=>{const v=N("RouterLink");return l(),r("div",null,[e("div",S,[e("img",{src:c.comment.avatar,alt:"User avatar",class:"w-10 h-10 rounded-full mr-1"},null,8,H),e("div",q,[e("div",z,[e("div",null,[e("h3",J,[h(v,{to:`/${c.comment.name}`},{default:x(()=>[_(i(c.comment.name),1)]),_:1},8,["to"])]),e("p",P,i(g(I)(c.comment.created_at))+" ago",1)])]),e("p",G,i(c.comment.body),1),e("button",{onClick:u[0]||(u[0]=m=>a.$emit("reply",c.comment.id)),class:"text-sm text-yellow-300 hover:underline mt-2"}," Reply ")])]),c.comment.replies&&c.comment.replies.length?(l(),r("div",K,[(l(!0),r(y,null,E(c.comment.replies,m=>(l(),L(j,{key:m.id,comment:m,onReply:u[1]||(u[1]=p=>a.$emit("reply"))},null,8,["comment"]))),128))])):b("",!0)])}}},O={key:0,class:"text-yellow-500 text-3xl"},Q={class:"min-h-screen text-white"},W={class:"container mx-auto"},X=e("div",{class:"bg-yellow-500 text-center w-full p-6 h-[200px]"},"header",-1),Y={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},Z={class:"block mx-auto pb-4 w-full bg-slate-900/30 backdrop-blur-sm"},ee={class:"flex justify-center"},te=["src"],oe={class:"text-center mt-6"},se={class:"text-3xl font-bold"},ne={class:"flex justify-center space-x-6 mt-4"},le={class:"text-sm"},ae=e("p",{class:"font-semibold"},"Books",-1),re={class:"text-sm"},ce=e("p",{class:"font-semibold"},"Followers",-1),ie={class:"p-4"},de={key:0,class:"mt-6"},me={key:0,class:"mb-2 p-2 bg-blue-100 rounded-lg text-blue-800"},ue={class:"bg-slate-900/30 backdrop-blur-sm p-4 rounded-lg"},pe={key:1},ve={key:2,class:"comment-section p-4 rounded-lg shadow-md"},fe=e("h2",{class:"text-lg font-semibold mb-4"},"Profile comments",-1),be={__name:"user_profile",setup(c){const w=T(),a=f(""),u=w.params.username,v=f(""),m=f([]),p=f(""),d=f(null);function k(t,o=null){const s=[];for(const n of t)if(n.parent_id===o){const C=k(t,n.id);C.length&&(n.replies=C),s.push(n)}return s}const A=t=>{d.value=t};function $(t,o){for(const s of t){if(s.id===o)return s;const n=$(s.replies||[],o);if(n)return n}return null}const B=async()=>{if(p.value.trim())try{const o=(await R.post("https://api-db-dbxo.onrender.com/api/comment/p",{userId,profileName:userName,body:p.value.trim(),parent_id:d.value?d.value.id:null},{headers:{Authorization:`${Cookies.get("accessToken")}`}})).data.comment;if(d.value){const s=$(m.value,d.value.id);s&&(s.replies||(s.replies=[]),s.replies.push(o))}else m.value.push(o);p.value="",d.value=null}catch(t){console.error("Error adding comment:",t)}};return U(async()=>{try{const o=await(await fetch(`https://api-db-dbxo.onrender.com/api/${u}/data`)).json();a.value=o,v.value=a.value.id}catch(t){console.error(t)}if(v)try{const t=await R.get(`https://api-db-dbxo.onrender.com/api/profile/comments/${v.value}`);m.value=k(t.data)}catch(t){console.error("Error loading comments:",t)}else console.log("Error: no id provided.")}),(t,o)=>{const s=N("RouterLink");return l(),r(y,null,[h(g(D),null,{default:x(()=>[e("title",null,i(a.value.name)+" on "+i(t.SITE_NAME),1)]),_:1}),t.error?(l(),r("div",O,i(t.error),1)):b("",!0),e("div",Q,[e("div",W,[_(" x "),X,e("div",Y,[e("div",Z,[e("div",ee,[e("img",{src:a.value.avatar||"default-avatar.png",alt:"User Avatar",class:"h-48 w-48 rounded-full border-4 border-white object-cover -translate-y-8"},null,8,te)]),e("div",oe,[e("h1",se,i(a.value.name||"USER.NAME"),1),e("div",ne,[e("div",le,[ae,e("p",null,i(a.value.bookCount||0),1)]),e("div",re,[ce,e("p",null,i(a.value.followersCount||0),1)]),_(" d ")])])]),e("div",ie,[g(F)?(l(),r("div",de,[d.value?(l(),r("div",me,[_(" Replying to: "+i(d.value.name)+" ",1),e("button",{onClick:o[0]||(o[0]=n=>d.value=null),class:"ml-2 text-red-500"},"Cancel")])):b("",!0),e("div",ue,[V(e("textarea",{"onUpdate:modelValue":o[1]||(o[1]=n=>p.value=n),placeholder:"Join the discussion...",class:"w-full p-2 border rounded-lg bg-slate-950 text-yellow-400 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3"},null,512),[[M,p.value]]),e("button",{onClick:B,class:"mt-2 bg-yellow-500 text-black px-4 py-2 rounded-lg hover:bg-yellow-600"}," Add comment ")])])):(l(),r("div",pe,[h(s,{class:"text-yellow-500 text-center mx-auto",to:"/login"},{default:x(()=>[_("Log in to leave a comment ")]),_:1})])),a.value.id?(l(),r("div",ve,[fe,(l(!0),r(y,null,E(m.value,n=>(l(),r("div",{key:n.id,class:"mb-4 bg-slate-900/30 backdrop-blur-sm p-4 rounded-lg"},[h(j,{comment:n,onReply:A},null,8,["comment"])]))),128))])):b("",!0)])])])])],64)}}};export{be as default};

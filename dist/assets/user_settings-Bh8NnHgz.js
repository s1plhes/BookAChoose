import{r as l,e as p,g as G,q as i,j as U,c as L,k as c,a as e,b as D,w as m,v as f,n as I,I as O,t as M,l as H,f as A,o as J,S as E}from"./index-vyn2smVK.js";import{c as K}from"./checkAuth-4erMPWyQ.js";const Q={class:"px-6 max-w-2xl w-full mx-auto"},W=e("h1",{class:"text-2xl font-bold text-slate-100 mb-4"},"Account Settings",-1),X={class:"p-4 bg-glass rounded-md"},Y={class:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 space-x-5"},Z={class:"flex mx-auto"},ee=["src"],se={class:"mb-4"},te=e("label",{for:"file",class:"text-white text-md font-semibold"},"Avatar ",-1),ae={class:"mb-4"},oe=e("label",{for:"name",class:"block text-md font-semibold text-slate-100"},"Name",-1),le={class:"mb-4"},ne=e("label",{for:"email",class:"block text-md font-semibold text-slate-100"},"Email",-1),re={class:"mb-4"},ie=e("label",{for:"current_password",class:"block text-md font-semibold text-slate-100"},"Current Password",-1),de=e("div",{class:"mb-4"},[e("label",{for:"new_password",class:"block text-md font-semibold text-slate-100"},"New Password"),e("input",{type:"input",placeholder:"Enter your new password",class:"input"})],-1),ue={class:"mb-4"},ce=e("label",{for:"confirm_password",class:"block text-md font-semibold text-slate-100"},"Confirm New Password",-1),pe=e("div",{class:"flex justify-center items-center"},[e("button",{class:"w-1/4 bg-yellow-500 hover:bg-yellow-600 text-black font-semibold py-2 px-4 rounded-md shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-white transition duration-150"}," Save ")],-1),me=e("h1",{id:"reading",class:"text-2xl font-bold text-slate-100 mb-4"},"Reading Settings",-1),fe={class:"bg-glass p-4 mb-4 text-white rounded-md"},ve=e("h2",{class:"text-xl font-semibold text-yellow-500"},"Chapter Text Size",-1),_e=e("label",{class:"text-sm"},"Determine how big your text will be, to make it easier to read your chapters, the default is 16px",-1),xe={class:"text-yellow-500"},ye={__name:"user_settings",setup(we){const v=l(""),_=l(""),x=l(""),w=l(""),N=l(""),b=l(""),u=l(""),h=l(""),V=p.get("accessToken"),d=l(p.get("fontSize")||18),g=l(""),y=l(null),z=l(""),S="https://api-db-dbxo.onrender.com/",$=async()=>{try{const s=n(d.value);s&&(p.set("fontSize",s,{expires:365}),d.value=s,g.value=`Font size set: ${d.value}px`)}catch(s){console.error("Failed to update font size:",s),g.value="Failed to set font size"}},n=s=>s.trim().replace(/</g,"&lt;").replace(/>/g,"&gt;"),T=async()=>{var s,t;try{if(i&&i.value&&i.value.userId){const a=await A.get(`${S}/users/${i.value.userId}`);a.status===200&&(v.value=n(a.data.name),_.value=n(a.data.email),x.value=n(a.data.avatar))}else u.value="User data not available"}catch(a){u.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.error)||"Failed to fetch user data"}},j=async()=>{var s,t;try{const a=n(w.value),r=n(N.value),C=n(b.value),o=n(v.value),q=n(_.value);if(r!==C)throw new Error("Passwords do not match");let k=x.value;if(y.value){const F=await B(y.value);if(F)k=F;else throw new Error("Avatar upload failed")}const P={name:o,email:q,avatar:k,password:a};r&&(P.password=r),(await A.put(`${S}/users/${i.value.userId}`,P,{headers:{Authorization:`Bearer ${V}`}})).status===200&&(p.set("name",o),p.set("avatar",k),h.value="Profile updated successfully!",u.value="")}catch(a){u.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.error)||a.message||"Failed to update profile",h.value=""}};async function B(s){if(!s)return z.value="Please select a file first",null;const t=new FormData;t.append("file",s);try{const r=await(await fetch(`${S}/upload`,{method:"POST",body:t})).json();return r.success?r.url:(z.value="File upload failed: "+r.message,null)}catch(a){return z.value="An error occurred: "+a.message,null}}function R(s){y.value=s.target.files[0]}return G(()=>{i&&i.value&&i.value.userId?T():u.value="User is not authenticated",K(i)}),(s,t)=>{const a=U("ErrorMessage"),r=U("SuccessMessage"),C=U("btn");return J(),L("div",Q,[W,c(E),e("div",X,[e("form",{onSubmit:D(j,["prevent"])},[e("div",Y,[e("div",Z,[e("img",{id:"userAvatar",src:x.value,alt:"user",class:"object-cover bg-yellow-500 border border-slate-800 h-48 w-48 rounded-md"},null,8,ee)]),e("div",null,[e("div",se,[te,e("input",{type:"file",name:"file",id:"file",onChange:R,class:"text-sm text-grey-500 file:mr-2 file:py-3 file:px-4 file:rounded-lg file:border-0 file:text-md file:font-semibold file:text-black file:bg-yellow-500 hover:file:cursor-pointer hover:file:opacity-80"},null,32)]),e("div",ae,[oe,m(e("input",{type:"text",id:"name","onUpdate:modelValue":t[0]||(t[0]=o=>v.value=o),class:"input",placeholder:"Enter your name"},null,512),[[f,v.value]])]),e("div",le,[ne,m(e("input",{type:"email",id:"email","onUpdate:modelValue":t[1]||(t[1]=o=>_.value=o),class:"input",placeholder:"Enter your email"},null,512),[[f,_.value]])])]),e("div",null,[e("div",re,[ie,m(e("input",{type:"password",id:"current_password","onUpdate:modelValue":t[2]||(t[2]=o=>w.value=o),required:"",class:"input",placeholder:"Enter your current password"},null,512),[[f,w.value]])]),de,e("div",ue,[ce,m(e("input",{type:"password",id:"confirm_password","onUpdate:modelValue":t[3]||(t[3]=o=>b.value=o),class:"input",placeholder:"Confirm your password"},null,512),[[f,b.value]])])])]),pe],32),c(a,{message:u.value,type:"error",autoClose:!1,autoCloseDelay:5e3},null,8,["message"]),c(r,{message:h.value,type:"success",autoClose:!1,autoCloseDelay:5e3},null,8,["message"])]),c(E),me,c(E),e("div",null,[e("form",{onSubmit:D($,["prevent"])},[e("div",fe,[ve,_e,m(e("input",{type:"text",class:"input oldstyle-nums","onUpdate:modelValue":t[4]||(t[4]=o=>d.value=o),name:"fontSize",placeholder:"Enter text size (pixels)"},null,512),[[f,d.value]]),e("p",null,[I(" Current text size: "),e("strong",{class:O(`text-[${d.value}px] oldstyle-nums`)},M(d.value)+" pixels",3)]),c(C,{type:"submit"},{default:H(()=>[I("Save")]),_:1}),e("p",xe,M(g.value),1)])],32)])])}}};export{ye as default};

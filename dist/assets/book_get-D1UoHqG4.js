import{_ as j,r as p,y as F,z as S,g as U,q as v,j as b,c as a,k as r,l as i,u as d,a as e,d as m,t as n,n as u,F as D,h as P,f as x,o as s,H,m as q,w as G,v as J,p as K,i as O,e as Q}from"./index-UL2W14HF.js";import{f as M}from"./formatDate-CRdf8c_1.js";const _=g=>(K("data-v-e862fca7"),g=g(),O(),g),W=_(()=>e("meta",{name:"robots",content:"index,follow"},null,-1)),X=_(()=>e("meta",{property:"og:type",content:"website"},null,-1)),Y=["content"],Z=["content"],ee=["content"],te=["content"],oe=["content"],se={class:"px-6 max-w-6xl mx-auto"},ae={key:0},le={key:0,class:"p-2 my-3 backdrop-blur-sm bg-slate-900/20 rounded w-fit"},ne={key:0,class:"space-x-4"},ce={class:"grid lg:grid-cols-2 md:grid-cols-2 sm:grid-cols-1 clearfix mb-3 space-x-8"},re={class:"mx-auto bg-glass p-3 rounded h-fit"},ie={class:"text-3xl font-bold text-zinc-50"},de={class:"text-lg text-zinc-100"},ue={key:0,class:"inline-flex items-center space-x-5 text-white"},_e={class:"space-x-1"},pe=_(()=>e("i",{class:"fa fa-heart mx-2"},null,-1)),he={class:"flex justify-center items-center self-center"},ve=["src"],me={id:"description",class:"text-slate-50"},ke=_(()=>e("p",{class:"mt-2 p-3 text-zinc-100"},"Description:",-1)),fe={class:"mt-2 p-3 text-zinc-100 bg-glass"},ge={class:"text-slate-200 p-2 text-xs"},be={class:"bg-glass p-3 rounded h-fit sm:mt-6 md:mt-4 mt-4"},xe=_(()=>e("h2",{class:"text-2xl font-bold text-zinc-50"},"Chapters",-1)),ye={class:"mt-4"},we={key:0},Be={class:"space-y-1"},Ee={class:"p-2 my-2 backdrop-blur-sm bg-slate-800/60 rounded hover:bg-slate-500/50"},$e={key:1},Ie=_(()=>e("h1",{class:"text-gray-100"},"There are no chapters available yet.",-1)),Le=[Ie],De={key:1},Me=_(()=>e("p",{class:"text-gray-100"},"No book data available or failed to load.",-1)),Ce=[Me],ze=_(()=>e("p",{class:"text-white my-2"},"Are you sure you want to delete this book?",-1)),Te={key:0,class:"text-red-500 my-2"},Ae={key:1,class:"text-red-500 my-2"},Ne={key:2,class:"text-green-500 my-2"},Re={class:"modal-actions"},Ve={__name:"book_get",setup(g){p("admin");const $=F(),C=S(),h=p(""),k=p(""),o=p({}),y=p([]),w=$.params.bookId,B=p(!1),I=$.params.bookId,E=p(0),z=async()=>{console.log("Fetching book...");try{const{data:t}=await x.get(`https://api-db-dbxo.onrender.com/api/book/${w}`);o.value=t,console.log("Book data:",t)}catch(t){console.error("Error fetching book:",t)}},T=async()=>{console.log("Fetching chapters...");try{const{data:t}=await x.get(`https://api-db-dbxo.onrender.com/api/allchapters/${w}`);y.value=t}catch(t){console.error("Error fetching chapters:",t)}},A=async()=>{const t=Q.get("accessToken");if(h.value==="DELETE")try{await x.delete(`https://api-db-dbxo.onrender.com/api/book/delete/${w}`,{headers:{Authorization:`Bearer ${t}`}}),alert("Book deleted successfully"),C.back()}catch(l){l.response&&l.response.status===404?(console.error("Book not found"),k.value="Book not found"):(console.error("Error deleting book:",l),k.value="Error deleting book")}finally{h.value=""}else k.value='Please type "delete" to confirm deletion',h.value=""},N=async()=>{try{const{data:t}=await x.get(`https://api-db-dbxo.onrender.com/api/count/likes/${I}/0`);t&&typeof t.likes=="number"?(E.value=t.likes,console.log("Likes count:",E.value)):console.error("Unexpected response structure:",t)}catch(t){console.error("Error getting likes",t)}};return U(()=>{z(),N(),T(),console.log(v)}),(t,l)=>{const f=b("Btn"),L=b("RouterLink"),R=b("LikeBtn"),V=b("Modal");return s(),a(D,null,[r(d(H),null,{default:i(()=>[e("title",null,n(o.value.title)+" | Book-A-Choose",1),W,X,e("meta",{property:"og:title",content:o.value.title},null,8,Y),e("meta",{property:"og:description",content:o.value.description},null,8,Z),e("meta",{property:"og:image",content:o.value.image},null,8,ee),e("meta",{property:"og:url",content:t.URL+"/book/"+o.value.id},null,8,te),e("meta",{name:"author",content:o.value.author},null,8,oe)]),_:1}),e("div",se,[o.value&&o.value.title?(s(),a("div",ae,[r(f,{class:"mb-10",variant:"primary",href:"/books/"},{default:i(()=>[u(" ← Back ")]),_:1}),d(v)?(s(),a("div",le,[o.value.author===d(v).name||d(v).role==="admin"?(s(),a("div",ne,[r(f,{variant:"primary",href:`/book/${o.value.id}/edit`},{default:i(()=>[u(" Edit Book ")]),_:1},8,["href"]),r(f,{variant:"danger",onClick:l[0]||(l[0]=c=>B.value=!0)},{default:i(()=>[u(" Delete book ")]),_:1}),r(f,{variant:"success",href:`/book/${o.value.id}/chapter/create`},{default:i(()=>[u(" Add Chapter ")]),_:1},8,["href"])])):m("",!0)])):m("",!0),e("div",ce,[e("div",re,[e("h1",ie,n(o.value.title),1),e("p",de,[u("By "),r(L,{class:"text-yellow-500",to:`/${o.value.author}`},{default:i(()=>[u(n(o.value.author),1)]),_:1},8,["to"])]),d(v)?(s(),a("div",ue,[r(R,{userId:d(v).id,bookId:d(I),chapterId:"0"},null,8,["userId","bookId"]),e("div",_e,[pe,u(" "+n(E.value)+" Likes ",1)])])):m("",!0),e("div",he,[e("img",{class:"object-scale-down object-center w-2/4 rounded",src:o.value.image},null,8,ve)]),e("div",me,[ke,e("p",fe,n(o.value.description),1)]),e("div",ge,[e("p",null,"Published date: "+n(d(M)(o.value.created_at)),1),e("p",null,"Last edit: "+n(d(M)(o.value.created_at)),1)])]),e("div",be,[e("div",null,[xe,e("div",ye,[y.value.length>0?(s(),a("div",we,[e("ul",Be,[(s(!0),a(D,null,P(y.value,c=>(s(),q(L,{key:c.chapter_id,to:`/book/${c.book_id}/chapter/${c.chapter_id}`,size:"small",variant:"text",class:"w-full text-left text-zinc-100"},{default:i(()=>[e("li",Ee,n(c.part.title),1)]),_:2},1032,["to"]))),128))])])):(s(),a("div",$e,Le))])])])])])):(s(),a("div",De,Ce))]),r(V,{showModal:B.value,title:"Delete Book","onUpdate:showModal":l[2]||(l[2]=c=>B.value=c)},{default:i(()=>[ze,G(e("input",{class:"input","onUpdate:modelValue":l[1]||(l[1]=c=>h.value=c),type:"text",placeholder:"Enter 'DELETE' to delete"},null,512),[[J,h.value]]),k.value?(s(),a("p",Te,n(k.value),1)):m("",!0),h.value!=="DELETE"?(s(),a("p",Ae," Invalid delete phrase ")):m("",!0),t.successMessage?(s(),a("p",Ne,n(t.successMessage),1)):m("",!0),e("div",Re,[r(f,{variant:"danger",onClick:A},{default:i(()=>[u("Delete")]),_:1})])]),_:1},8,["showModal"])],64)}}},Se=j(Ve,[["__scopeId","data-v-e862fca7"]]);export{Se as default};

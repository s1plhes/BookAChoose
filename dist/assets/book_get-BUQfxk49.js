import{_ as j,r as h,y as F,z as P,g as S,q as v,j as y,c as a,k as r,l as i,u as d,a as e,d as m,t as n,n as u,F as M,h as H,f as x,o as s,H as q,m as G,w as J,v as K,p as O,i as Q,e as W}from"./index-vyn2smVK.js";import{f as C}from"./formatDate-CRdf8c_1.js";const _=b=>(O("data-v-5b8b8c2b"),b=b(),Q(),b),X=_(()=>e("meta",{name:"robots",content:"index,follow"},null,-1)),Y=_(()=>e("meta",{property:"og:type",content:"website"},null,-1)),Z=["content"],ee=["content"],te=["content"],oe=["content"],se=["content"],ae={class:"px-6 max-w-6xl mx-auto"},le={key:0},ne={key:0,class:"p-2 my-3 backdrop-blur-sm bg-slate-900/20 rounded w-fit"},ce={key:0,class:"space-x-4"},re={class:"grid lg:grid-cols-2 md:grid-cols-2 sm:grid-cols-1 clearfix mb-3 space-x-8"},ie={class:"mx-auto bg-glass p-3 rounded h-fit"},de={class:"text-3xl font-bold text-zinc-50"},ue={class:"text-lg text-zinc-100"},_e={key:0,class:"inline-flex items-center space-x-5 text-white"},he={class:"space-x-1"},pe=_(()=>e("i",{class:"fa fa-heart mx-2"},null,-1)),ve={class:"flex justify-center items-center self-center"},me=["src"],ke={id:"description",class:"text-slate-50"},ge=_(()=>e("p",{class:"mt-2 p-3 text-zinc-100"},"Description:",-1)),be={class:"mt-2 p-3 text-zinc-100 bg-glass"},fe={class:"text-slate-200 p-2 text-xs"},ye={class:"bg-glass p-3 rounded h-fit sm:mt-6 md:mt-4 mt-4"},xe=_(()=>e("h2",{class:"text-2xl font-bold text-zinc-50"},"Chapters",-1)),we={class:"mt-4"},Be={key:0},Ee={class:"space-y-1"},$e={class:"p-2 my-2 backdrop-blur-sm bg-slate-800/60 rounded hover:bg-slate-500/50"},Ie={key:1},Le=_(()=>e("h1",{class:"text-gray-100"},"There are no chapters available yet.",-1)),De=[Le],Me={key:1},Ce=_(()=>e("p",{class:"text-gray-100"},"No book data available or failed to load.",-1)),ze=[Ce],Te=_(()=>e("p",{class:"text-white my-2"},"Are you sure you want to delete this book?",-1)),Ae={key:0,class:"text-red-500 my-2"},Re={key:1,class:"text-red-500 my-2"},Ne={key:2,class:"text-green-500 my-2"},Ue={class:"modal-actions"},Ve={__name:"book_get",setup(b){h("admin");const I=F(),z=P(),p=h(""),k=h(""),o=h({}),w=h([]),B=I.params.bookId,E=h(!1),L=I.params.bookId,$=h(0),f="https://api-db-dbxo.onrender.com/",T=async()=>{console.log("Fetching book...");try{const{data:t}=await x.get(`${f}/book/${B}`);o.value=t,console.log("Book data:",t)}catch(t){console.error("Error fetching book:",t)}},A=async()=>{console.log("Fetching chapters...");try{const{data:t}=await x.get(`${f}/allchapters/${B}`);w.value=t}catch(t){console.error("Error fetching chapters:",t)}},R=async()=>{const t=W.get("accessToken");if(p.value==="DELETE")try{await x.delete(`${f}/book/delete/${B}`,{headers:{Authorization:`Bearer ${t}`}}),alert("Book deleted successfully"),z.back()}catch(l){l.response&&l.response.status===404?(console.error("Book not found"),k.value="Book not found"):(console.error("Error deleting book:",l),k.value="Error deleting book")}finally{p.value=""}else k.value='Please type "delete" to confirm deletion',p.value=""},N=async()=>{try{const{data:t}=await x.get(`${f}/count/likes/${L}/0`);t&&typeof t.likes=="number"?($.value=t.likes,console.log("Likes count:",$.value)):console.error("Unexpected response structure:",t)}catch(t){console.error("Error getting likes",t)}};return S(()=>{T(),N(),A(),console.log(v)}),(t,l)=>{const g=y("Btn"),D=y("RouterLink"),U=y("LikeBtn"),V=y("Modal");return s(),a(M,null,[r(d(q),null,{default:i(()=>[e("title",null,n(o.value.title)+" | Book-A-Choose",1),X,Y,e("meta",{property:"og:title",content:o.value.title},null,8,Z),e("meta",{property:"og:description",content:o.value.description},null,8,ee),e("meta",{property:"og:image",content:o.value.image},null,8,te),e("meta",{property:"og:url",content:t.URL+"/book/"+o.value.id},null,8,oe),e("meta",{name:"author",content:o.value.author},null,8,se)]),_:1}),e("div",ae,[o.value&&o.value.title?(s(),a("div",le,[r(g,{class:"mb-10",variant:"primary",href:"/books/"},{default:i(()=>[u(" ← Back ")]),_:1}),d(v)?(s(),a("div",ne,[o.value.author===d(v).name||d(v).role==="admin"?(s(),a("div",ce,[r(g,{variant:"primary",href:`/book/${o.value.id}/edit`},{default:i(()=>[u(" Edit Book ")]),_:1},8,["href"]),r(g,{variant:"danger",onClick:l[0]||(l[0]=c=>E.value=!0)},{default:i(()=>[u(" Delete book ")]),_:1}),r(g,{variant:"success",href:`/book/${o.value.id}/chapter/create`},{default:i(()=>[u(" Add Chapter ")]),_:1},8,["href"])])):m("",!0)])):m("",!0),e("div",re,[e("div",ie,[e("h1",de,n(o.value.title),1),e("p",ue,[u("By "),r(D,{class:"text-yellow-500",to:`/${o.value.author}`},{default:i(()=>[u(n(o.value.author),1)]),_:1},8,["to"])]),d(v)?(s(),a("div",_e,[r(U,{userId:d(v).id,bookId:d(L),chapterId:"0"},null,8,["userId","bookId"]),e("div",he,[pe,u(" "+n($.value)+" Likes ",1)])])):m("",!0),e("div",ve,[e("img",{class:"object-scale-down object-center w-2/4 rounded",src:o.value.image},null,8,me)]),e("div",ke,[ge,e("p",be,n(o.value.description),1)]),e("div",fe,[e("p",null,"Published date: "+n(d(C)(o.value.created_at)),1),e("p",null,"Last edit: "+n(d(C)(o.value.created_at)),1)])]),e("div",ye,[e("div",null,[xe,e("div",we,[w.value.length>0?(s(),a("div",Be,[e("ul",Ee,[(s(!0),a(M,null,H(w.value,c=>(s(),G(D,{key:c.chapter_id,to:`/book/${c.book_id}/chapter/${c.chapter_id}`,size:"small",variant:"text",class:"w-full text-left text-zinc-100"},{default:i(()=>[e("li",$e,n(c.part.title),1)]),_:2},1032,["to"]))),128))])])):(s(),a("div",Ie,De))])])])])])):(s(),a("div",Me,ze))]),r(V,{showModal:E.value,title:"Delete Book","onUpdate:showModal":l[2]||(l[2]=c=>E.value=c)},{default:i(()=>[Te,J(e("input",{class:"input","onUpdate:modelValue":l[1]||(l[1]=c=>p.value=c),type:"text",placeholder:"Enter 'DELETE' to delete"},null,512),[[K,p.value]]),k.value?(s(),a("p",Ae,n(k.value),1)):m("",!0),p.value!=="DELETE"?(s(),a("p",Re," Invalid delete phrase ")):m("",!0),t.successMessage?(s(),a("p",Ne,n(t.successMessage),1)):m("",!0),e("div",Ue,[r(g,{variant:"danger",onClick:R},{default:i(()=>[u("Delete")]),_:1})])]),_:1},8,["showModal"])],64)}}},Pe=j(Ve,[["__scopeId","data-v-5b8b8c2b"]]);export{Pe as default};

import{j as E,o as n,c as r,a as e,k as h,l as x,n as _,t as i,u as y,F as w,h as A,m as B,d as b,y as T,r as f,g as V,f as N,w as I,v as M,H as D,q as F}from"./index-vyn2smVK.js";import{f as S}from"./formatDate-CRdf8c_1.js";const H={class:"flex items-start space-x-4"},P=["src"],q={class:"flex-1"},z={class:"flex justify-between items-center"},J={class:"font-semibold text-yellow-500"},G={class:"text-sm text-gray-500"},K={class:"text-slate-200 mt-2"},O={key:0,class:"ml-12 mt-4"},L={__name:"pComment",props:["comment"],emits:["reply"],setup(c,{emit:k}){return(a,m)=>{const p=E("RouterLink");return n(),r("div",null,[e("div",H,[e("img",{src:c.comment.avatar,alt:"User avatar",class:"w-10 h-10 rounded-full mr-1"},null,8,P),e("div",q,[e("div",z,[e("div",null,[e("h3",J,[h(p,{to:`/${c.comment.name}`},{default:x(()=>[_(i(c.comment.name),1)]),_:1},8,["to"])]),e("p",G,i(y(S)(c.comment.created_at))+" ago",1)])]),e("p",K,i(c.comment.body),1),e("button",{onClick:m[0]||(m[0]=u=>a.$emit("reply",c.comment.id)),class:"text-sm text-yellow-300 hover:underline mt-2"}," Reply ")])]),c.comment.replies&&c.comment.replies.length?(n(),r("div",O,[(n(!0),r(w,null,A(c.comment.replies,u=>(n(),B(L,{key:u.id,comment:u,onReply:m[1]||(m[1]=v=>a.$emit("reply"))},null,8,["comment"]))),128))])):b("",!0)])}}},Q={key:0,class:"text-yellow-500 text-3xl"},W={class:"min-h-screen text-white"},X={class:"container mx-auto"},Y=e("div",{class:"bg-yellow-500 text-center w-full p-6 h-[200px]"},"header",-1),Z={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},ee={class:"block mx-auto pb-4 w-full bg-slate-900/30 backdrop-blur-sm"},te={class:"flex justify-center"},oe=["src"],se={class:"text-center mt-6"},le={class:"text-3xl font-bold"},ne={class:"flex justify-center space-x-6 mt-4"},ae={class:"text-sm"},re=e("p",{class:"font-semibold"},"Books",-1),ce={class:"text-sm"},ie=e("p",{class:"font-semibold"},"Followers",-1),de={class:"p-4"},ue={key:0,class:"mt-6"},me={key:0,class:"mb-2 p-2 bg-blue-100 rounded-lg text-blue-800"},ve={class:"bg-slate-900/30 backdrop-blur-sm p-4 rounded-lg"},pe={key:1},fe={key:2,class:"comment-section p-4 rounded-lg shadow-md"},_e=e("h2",{class:"text-lg font-semibold mb-4"},"Profile comments",-1),ge={__name:"user_profile",setup(c){const k=T(),a=f(""),m=k.params.username,p=f(""),u=f([]),v=f(""),d=f(null),g="https://api-db-dbxo.onrender.com/";function $(t,o=null){const s=[];for(const l of t)if(l.parent_id===o){const R=$(t,l.id);R.length&&(l.replies=R),s.push(l)}return s}const U=t=>{d.value=t};function C(t,o){for(const s of t){if(s.id===o)return s;const l=C(s.replies||[],o);if(l)return l}return null}const j=async()=>{if(v.value.trim())try{const o=(await N.post(`${g}/comment/p`,{userId,profileName:userName,body:v.value.trim(),parent_id:d.value?d.value.id:null},{headers:{Authorization:`${Cookies.get("accessToken")}`}})).data.comment;if(d.value){const s=C(u.value,d.value.id);s&&(s.replies||(s.replies=[]),s.replies.push(o))}else u.value.push(o);v.value="",d.value=null}catch(t){console.error("Error adding comment:",t)}};return V(async()=>{try{const o=await(await fetch(`${g}/${m}/data`)).json();a.value=o,p.value=a.value.id}catch(t){console.error(t)}if(p)try{const t=await N.get(`${g}/profile/comments/${p.value}`);u.value=$(t.data)}catch(t){console.error("Error loading comments:",t)}else console.log("Error: no id provided.")}),(t,o)=>{const s=E("RouterLink");return n(),r(w,null,[h(y(D),null,{default:x(()=>[e("title",null,i(a.value.name)+" on "+i(t.SITE_NAME),1)]),_:1}),t.error?(n(),r("div",Q,i(t.error),1)):b("",!0),e("div",W,[e("div",X,[_(" x "),Y,e("div",Z,[e("div",ee,[e("div",te,[e("img",{src:a.value.avatar||"default-avatar.png",alt:"User Avatar",class:"h-48 w-48 rounded-full border-4 border-white object-cover -translate-y-8"},null,8,oe)]),e("div",se,[e("h1",le,i(a.value.name||"USER.NAME"),1),e("div",ne,[e("div",ae,[re,e("p",null,i(a.value.bookCount||0),1)]),e("div",ce,[ie,e("p",null,i(a.value.followersCount||0),1)]),_(" d ")])])]),e("div",de,[y(F)?(n(),r("div",ue,[d.value?(n(),r("div",me,[_(" Replying to: "+i(d.value.name)+" ",1),e("button",{onClick:o[0]||(o[0]=l=>d.value=null),class:"ml-2 text-red-500"},"Cancel")])):b("",!0),e("div",ve,[I(e("textarea",{"onUpdate:modelValue":o[1]||(o[1]=l=>v.value=l),placeholder:"Join the discussion...",class:"w-full p-2 border rounded-lg bg-slate-950 text-yellow-400 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3"},null,512),[[M,v.value]]),e("button",{onClick:j,class:"mt-2 bg-yellow-500 text-black px-4 py-2 rounded-lg hover:bg-yellow-600"}," Add comment ")])])):(n(),r("div",pe,[h(s,{class:"text-yellow-500 text-center mx-auto",to:"/login"},{default:x(()=>[_("Log in to leave a comment ")]),_:1})])),a.value.id?(n(),r("div",fe,[_e,(n(!0),r(w,null,A(u.value,l=>(n(),r("div",{key:l.id,class:"mb-4 bg-slate-900/30 backdrop-blur-sm p-4 rounded-lg"},[h(L,{comment:l,onReply:U},null,8,["comment"])]))),128))])):b("",!0)])])])])],64)}}};export{ge as default};

import{r as l,e as p,g as q,q as i,j as k,c as G,k as c,a as e,b as P,w as m,v as f,n as D,I as O,t as M,l as H,f as I,o as J,S as U}from"./index-UL2W14HF.js";import{c as K}from"./checkAuth-C1L3xOAG.js";const L={class:"px-6 max-w-2xl w-full mx-auto"},Q=e("h1",{class:"text-2xl font-bold text-slate-100 mb-4"},"Account Settings",-1),W={class:"p-4 bg-glass rounded-md"},X={class:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 space-x-5"},Y={class:"flex mx-auto"},Z=["src"],ee={class:"mb-4"},se=e("label",{for:"file",class:"text-white text-md font-semibold"},"Avatar ",-1),te={class:"mb-4"},ae=e("label",{for:"name",class:"block text-md font-semibold text-slate-100"},"Name",-1),oe={class:"mb-4"},le=e("label",{for:"email",class:"block text-md font-semibold text-slate-100"},"Email",-1),ne={class:"mb-4"},re=e("label",{for:"current_password",class:"block text-md font-semibold text-slate-100"},"Current Password",-1),ie=e("div",{class:"mb-4"},[e("label",{for:"new_password",class:"block text-md font-semibold text-slate-100"},"New Password"),e("input",{type:"input",placeholder:"Enter your new password",class:"input"})],-1),de={class:"mb-4"},ue=e("label",{for:"confirm_password",class:"block text-md font-semibold text-slate-100"},"Confirm New Password",-1),ce=e("div",{class:"flex justify-center items-center"},[e("button",{class:"w-1/4 bg-yellow-500 hover:bg-yellow-600 text-black font-semibold py-2 px-4 rounded-md shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-white transition duration-150"}," Save ")],-1),pe=e("h1",{id:"reading",class:"text-2xl font-bold text-slate-100 mb-4"},"Reading Settings",-1),me={class:"bg-glass p-4 mb-4 text-white rounded-md"},fe=e("h2",{class:"text-xl font-semibold text-yellow-500"},"Chapter Text Size",-1),ve=e("label",{class:"text-sm"},"Determine how big your text will be, to make it easier to read your chapters, the default is 16px",-1),be={class:"text-yellow-500"},ge={__name:"user_settings",setup(xe){const v=l(""),b=l(""),x=l(""),_=l(""),N=l(""),h=l(""),u=l(""),w=l(""),V=p.get("accessToken"),d=l(p.get("fontSize")||18),g=l(""),y=l(null),z=l(""),$=async()=>{try{const s=n(d.value);s&&(p.set("fontSize",s,{expires:365}),d.value=s,g.value=`Font size set: ${d.value}px`)}catch(s){console.error("Failed to update font size:",s),g.value="Failed to set font size"}},n=s=>s.trim().replace(/</g,"&lt;").replace(/>/g,"&gt;"),A=async()=>{var s,t;try{if(i&&i.value&&i.value.userId){const a=await I.get(`https://api-db-dbxo.onrender.com/api/users/${i.value.userId}`);a.status===200&&(v.value=n(a.data.name),b.value=n(a.data.email),x.value=n(a.data.avatar))}else u.value="User data not available"}catch(a){u.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.error)||"Failed to fetch user data"}},T=async()=>{var s,t;try{const a=n(_.value),r=n(N.value),S=n(h.value),o=n(v.value),R=n(b.value);if(r!==S)throw new Error("Passwords do not match");let C=x.value;if(y.value){const F=await j(y.value);if(F)C=F;else throw new Error("Avatar upload failed")}const E={name:o,email:R,avatar:C,password:a};r&&(E.password=r),(await I.put(`https://api-db-dbxo.onrender.com/api/users/${i.value.userId}`,E,{headers:{Authorization:`Bearer ${V}`}})).status===200&&(p.set("name",o),p.set("avatar",C),w.value="Profile updated successfully!",u.value="")}catch(a){u.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.error)||a.message||"Failed to update profile",w.value=""}};async function j(s){if(!s)return z.value="Please select a file first",null;const t=new FormData;t.append("file",s);try{const r=await(await fetch("https://api-db-dbxo.onrender.com/api/upload",{method:"POST",body:t})).json();return r.success?r.url:(z.value="File upload failed: "+r.message,null)}catch(a){return z.value="An error occurred: "+a.message,null}}function B(s){y.value=s.target.files[0]}return q(()=>{i&&i.value&&i.value.userId?A():u.value="User is not authenticated",K(i)}),(s,t)=>{const a=k("ErrorMessage"),r=k("SuccessMessage"),S=k("btn");return J(),G("div",L,[Q,c(U),e("div",W,[e("form",{onSubmit:P(T,["prevent"])},[e("div",X,[e("div",Y,[e("img",{id:"userAvatar",src:x.value,alt:"user",class:"object-cover bg-yellow-500 border border-slate-800 h-48 w-48 rounded-md"},null,8,Z)]),e("div",null,[e("div",ee,[se,e("input",{type:"file",name:"file",id:"file",onChange:B,class:"text-sm text-grey-500 file:mr-2 file:py-3 file:px-4 file:rounded-lg file:border-0 file:text-md file:font-semibold file:text-black file:bg-yellow-500 hover:file:cursor-pointer hover:file:opacity-80"},null,32)]),e("div",te,[ae,m(e("input",{type:"text",id:"name","onUpdate:modelValue":t[0]||(t[0]=o=>v.value=o),class:"input",placeholder:"Enter your name"},null,512),[[f,v.value]])]),e("div",oe,[le,m(e("input",{type:"email",id:"email","onUpdate:modelValue":t[1]||(t[1]=o=>b.value=o),class:"input",placeholder:"Enter your email"},null,512),[[f,b.value]])])]),e("div",null,[e("div",ne,[re,m(e("input",{type:"password",id:"current_password","onUpdate:modelValue":t[2]||(t[2]=o=>_.value=o),required:"",class:"input",placeholder:"Enter your current password"},null,512),[[f,_.value]])]),ie,e("div",de,[ue,m(e("input",{type:"password",id:"confirm_password","onUpdate:modelValue":t[3]||(t[3]=o=>h.value=o),class:"input",placeholder:"Confirm your password"},null,512),[[f,h.value]])])])]),ce],32),c(a,{message:u.value,type:"error",autoClose:!1,autoCloseDelay:5e3},null,8,["message"]),c(r,{message:w.value,type:"success",autoClose:!1,autoCloseDelay:5e3},null,8,["message"])]),c(U),pe,c(U),e("div",null,[e("form",{onSubmit:P($,["prevent"])},[e("div",me,[fe,ve,m(e("input",{type:"text",class:"input oldstyle-nums","onUpdate:modelValue":t[4]||(t[4]=o=>d.value=o),name:"fontSize",placeholder:"Enter text size (pixels)"},null,512),[[f,d.value]]),e("p",null,[D(" Current text size: "),e("strong",{class:O(`text-[${d.value}px] oldstyle-nums`)},M(d.value)+" pixels",3)]),c(S,{type:"submit"},{default:H(()=>[D("Save")]),_:1}),e("p",be,M(g.value),1)])],32)])])}}};export{ge as default};
